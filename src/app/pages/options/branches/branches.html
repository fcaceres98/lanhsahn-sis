<mat-card>
    <mat-card-title>
        <h3 class="title">Lista de Sucursales</h3>
    </mat-card-title>
    <mat-divider></mat-divider>
    <mat-card-content>
        <div fxFlex="100" fxLayout="column" fxLayoutGap="10px">
            <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px">
                <button matIconButton fxFlex="nogrow" (click)="add()">
                    <mat-icon>add</mat-icon>
                </button>

                <mat-form-field appearance="fill" fxFlex>
                    <mat-label for="search_query">Consulta por {{columnDisplay}}</mat-label>
                    <input id="search_query" matInput placeholder="Ex. Sucursales" [(ngModel)]="query" (keyup.Enter)="applyFilter($event)">
                    <button matSuffix matIconButton aria-label="Clear" (click)="get()">
                        <mat-icon>send</mat-icon>
                    </button>
                </mat-form-field>

                <button matIconButton fxFlex="nogrow" (click)="refresh()">
                    <mat-icon>refresh</mat-icon>
                </button>
            </div>
            @if (isLoading()) {
                <div fxFlex="100" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="10px">
                    <mat-spinner diameter="30"></mat-spinner>
                    <span>Cargando...</span>
                </div>
            } @else if (dataSource && dataSource.data && dataSource.data.length === 0) {
                <div fxFlex="100" fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="10px">
                    <mat-icon>info</mat-icon>
                    <span>No hay datos disponibles</span>
                </div>
            } @else if (dataSource.data) {
                <div fxFlex="100" class="mat-elevation-z8">
                    <mat-table [dataSource]="dataSource.data">
                
                        <!-- id Column -->
                        <ng-container matColumnDef="id">
                            <mat-header-cell *matHeaderCellDef fxFlex="5" fxFlex.lt-md="20" (click)="setColumnFilter('No', 'id')"> No </mat-header-cell>
                            <mat-cell *matCellDef="let element" fxFlex="5" fxFlex.lt-md="20"> {{element.id}} </mat-cell>
                        </ng-container>
                        
                        <!-- name Column -->
                        <ng-container matColumnDef="name">
                            <mat-header-cell *matHeaderCellDef fxFlex (click)="setColumnFilter('Nombre', 'name')"> Nombre </mat-header-cell>
                            <mat-cell *matCellDef="let element" fxFlex> {{element.name}} </mat-cell>
                        </ng-container>

                        <!-- direction Column -->
                        <ng-container matColumnDef="direction">
                            <mat-header-cell *matHeaderCellDef fxFlex fxHide.lt-md (click)="setColumnFilter('Dirección', 'direction')"> Dirección </mat-header-cell>
                            <mat-cell *matCellDef="let element" fxFlex fxHide.lt-md> {{element.direction}} </mat-cell>
                        </ng-container>

                        <!-- telephone Column -->
                        <ng-container matColumnDef="telephone">
                            <mat-header-cell *matHeaderCellDef fxFlex="10" fxHide.lt-md (click)="setColumnFilter('Teléfono', 'telephone')"> Teléfono </mat-header-cell>
                            <mat-cell *matCellDef="let element" fxFlex="10" fxHide.lt-md> {{element.telephone}} </mat-cell>
                        </ng-container>
                        
                        <!-- options Column -->
                        <ng-container matColumnDef="options">
                            <mat-header-cell *matHeaderCellDef fxFlex="10" fxFlex.lt-md="25"> Opciones </mat-header-cell>
                            <mat-cell *matCellDef="let element" fxFlex="10" fxFlex.lt-md="25">
                                <button mat-icon-button [matMenuTriggerFor]="menu">
                                    <mat-icon class="mat-icon-black">settings</mat-icon>
                                </button>
                                <mat-menu #menu="matMenu">
                                    <button mat-menu-item fxHide.gt-md (click)="show(element)">
                                        <mat-icon>search</mat-icon>
                                        Mostrar
                                    </button>
                                    <button mat-menu-item (click)="edit(element)">
                                        <mat-icon>edit</mat-icon>
                                        Editar
                                    </button>
                                    @if (element.status === 1) {
                                        <button mat-menu-item (click)="disable(element)">
                                            <mat-icon>delete</mat-icon>
                                            Deshabilitar
                                        </button>
                                    }
                                    @if (element.status === 0) {
                                        <button mat-menu-item (click)="enable(element)">
                                            <mat-icon>restore_from_trash</mat-icon>
                                            Habilitar
                                        </button>
                                    }
                                </mat-menu>
                            </mat-cell>
                        </ng-container>

                        <mat-header-row *matHeaderRowDef="columnsToDisplay"></mat-header-row>
                        <mat-row [ngClass]="getColor(i, row)" *matRowDef="let row; columns: columnsToDisplay; let i = index"></mat-row>

                        <!-- Row shown when there is no matching data.-->
                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="5">No hay datos disponibles</td>
                        </tr>
                    </mat-table>

                    <mat-paginator 
                        [length]="dataSource.total"
                        [pageSizeOptions]="[5, 10, 20, 50]"
                        [pageSize]="dataSource.per_page"
                        showFirstLastButtons
                        (page)="pageEvent = $event; onPaginateChange($event)">
                    </mat-paginator>
                </div>
            }
        </div>
        
    </mat-card-content>
</mat-card>
